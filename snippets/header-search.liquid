{% comment %}
  Renders a header search modal. Should be used with 'header.liquid'
{% endcomment %}

<style>
.recommended-search__wrapper {
  display: flex;
  gap: 2rem;
  padding: 2.2rem;
  background-color: #ffffff;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  flex-wrap: wrap;
  max-width: 100vw;     
  overflow-x: hidden;  
}

.recommended-search__collections {
  flex: 1 1 26%;
}

.recommended-search__collections .recommended-search__title {
  font-weight: 600;
  font-size: 1.4rem;
  margin-bottom: 1rem;
  color: #222;
  border-bottom: 1px solid #eee;
  padding-left: 0.25rem;
}

.recommended-search__collections .predictive-search__list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.recommended-search__collections .predictive-search__list li {
  margin: 0.8rem 0;
}

.recommended-search__collections .predictive-search__list li a {
  display: block;
  color: inherit;     
  text-decoration: none; 
  cursor: pointer;      
  padding: 0.5rem 1rem;
  background-color: #f7f7f7;
  border-radius: 8px;
  color: #333;
  font-weight: 500;
  {% comment %} text-align: center; {% endcomment %}
  transition: box-shadow 0.2s ease;
}

.recommended-search__collections .predictive-search__list li a:hover {
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.recommended-search__products {
  flex: 1 1 65%;
}

.recommended-search__products .recommended-search__title {
  font-weight: 600;
  font-size: 1.4rem;
  margin-bottom: 1rem;
  color: #222;
  border-bottom: 1px solid #eee;
  padding-left: 0.25rem;
}

.recommended-search__product-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-wrap: wrap;
  gap: 1.2rem;
}

.recommended-search__product-item {
  flex: 1 1 48%;
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  padding: 0.5rem;
  border-radius: 10px;
  transition: box-shadow 0.2s ease;
}

.recommended-search__product-item:hover {
  box-shadow: 0 6px 16px rgba(0,0,0,0.12);
}

.recommended-search__product-link {
  display: flex;
  text-decoration: none;
  color: inherit;
  width: 100%;
}

.recommended-search__product-image img {
  width: 120px;
  height: 120px;
  object-fit: cover;
  border-radius: 6px;
  display:block;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

.recommended-search__product-info {
  display: flex;
  flex-direction: column;
  justify-content: space-around;
  margin-left:10px;
}

.recommended-search__product-title {
  font-size: 1.2rem;
  font-weight: 600;
  color: #232323;
  display: -webkit-box;        
  -webkit-line-clamp: 2;       
  -webkit-box-orient: vertical;
  overflow: hidden;           
  text-overflow: ellipsis;    
  white-space: normal;         
  word-wrap: break-word;      
}

.recommended-search__product-price {
  font-size: 1.2rem;
  font-weight: 600;
  color: red;
}

@media (max-width: 768px) {

  .recommended-search__wrapper {
    flex-direction: column;
    padding: 1rem;
    gap: 1.5rem;
  }

  .recommended-search__collections,
  .recommended-search__products {
    flex: none;
    width: 100%;         
  }

  .recommended-search__collections .predictive-search__list {
    display: flex;
    flex-wrap: wrap;       
    gap: 0.5rem;
    padding-bottom: 0.5rem;
  }

  .recommended-search__collections .predictive-search__list li {
    flex: 0 0 auto;
    margin: 0;
  }

  .recommended-search__collections .predictive-search__list li a {
    padding: 0.75rem 1rem;
  }

  .recommended-search__product-list {
    display: flex;
    flex-wrap: nowrap;      
    overflow-x: auto;        
    gap: 1rem;
    padding-bottom: 0.5rem;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;  
  }
  .recommended-search__product-list::-webkit-scrollbar {
    display: none;
  }

  .recommended-search__product-item {
    flex: 0 0 290px; 
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0.5rem;
    border-radius: 10px;
    transition: box-shadow 0.2s ease;
  }

  .recommended-search__product-item:hover {
    box-shadow: 0 6px 16px rgba(0,0,0,0.12);
  }

  .recommended-search__product-image img {
    width: 100px;
    height: 100px;
    object-fit: cover;
    border-radius: 6px;
    display: block;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  }

  .recommended-search__product-info {
    margin-left: 10px;
  }

  .recommended-search__product-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: #232323;
    word-wrap: break-word;
    white-space: normal;
  }

  .recommended-search__product-price {
    font-size: 1.2rem;
    font-weight: 600;
    color: red;
    margin-top: 0.25rem;
  }
}

</style>

<details-modal class="header__search">
  <details>
    <summary
      class="header__icon header__icon--search header__icon--summary link focus-inset modal__toggle"
      aria-haspopup="dialog"
      aria-label="{{ 'general.search.search' | t }}"
    >
      <span>
        <span class="svg-wrapper">
          {{- 'icon-search.svg' | inline_asset_content -}}
        </span>
        <span class="svg-wrapper header__icon-close">
          {{- 'icon-close.svg' | inline_asset_content -}}
        </span>
      </span>
    </summary>

    <div class="search-modal modal__content gradient" role="dialog" aria-modal="true"
      aria-label="{{ 'general.search.search' | t }}">
      <div class="modal-overlay"></div>
      <div class="search-modal__content{% if settings.inputs_shadow_vertical_offset != 0 and settings.inputs_shadow_vertical_offset < 0 %} search-modal__content-top{% else %} search-modal__content-bottom{% endif %}"
        tabindex="-1">

        {%- if settings.predictive_search_enabled -%}
          <predictive-search class="search-modal__form" data-loading-text="{{ 'accessibility.loading' | t }}">
        {%- else -%}
          <search-form class="search-modal__form">
        {%- endif -%}

        <form action="{{ routes.search_url }}" method="get" role="search" class="search search-modal__form">
          <div class="field">
            <input
              class="search__input field__input"
              id="{{ input_id }}"
              type="search"
              name="q"
              value="{{ search.terms | escape }}"
              placeholder="{{ 'general.search.search' | t }}"
              {%- if settings.predictive_search_enabled -%}
                role="combobox"
                aria-expanded="false"
                aria-owns="predictive-search-results"
                aria-controls="predictive-search-results"
                aria-haspopup="listbox"
                aria-autocomplete="list"
                autocorrect="off"
                autocomplete="off"
                autocapitalize="off"
                spellcheck="false"
              {%- endif -%}
            >
            <label class="field__label" for="{{ input_id }}">{{ 'general.search.search' | t }}</label>
            <input type="hidden" name="options[prefix]" value="last">
            <button type="reset"
              class="reset__button field__button{% if search.terms == blank %} hidden{% endif %}"
              aria-label="{{ 'general.search.reset' | t }}">
              <span class="svg-wrapper">
                {{- 'icon-reset.svg' | inline_asset_content -}}
              </span>
            </button>
            <button class="search__button field__button" aria-label="{{ 'general.search.search' | t }}">
              <span class="svg-wrapper">
                {{- 'icon-search.svg' | inline_asset_content -}}
              </span>
            </button>
          </div>

          {%- if settings.predictive_search_enabled -%}

            <!-- Shopify native predictive search results container -->
            <div class="predictive-search predictive-search--header" tabindex="-1" data-predictive-search>
              {%- render 'loading-spinner', class: 'predictive-search__loading-state' -%}
              <div id="predictive-search-results"></div>
            </div>

            <!-- Recommended search container -->
            <div class="recommended-search predictive-search predictive-search--header" id="recommended-search">
              <div class="recommended-search__wrapper">

                <!-- Recherches populaires -->
                {% comment %} <div class="recommended-search__collections">
                  <div class="recommended-search__title">Recherches populaires</div>
                  <ul class="predictive-search__list">
                    {% for i in (1..6) %}
                      {% assign collection_key = 'recommended_collection_' | append: i %}
                      {% assign collection_item = settings[collection_key] %}
                      {% if collection_item != blank %}
                        <li>
                          <a href="{{ collection_item.url }}">{{ collection_item.title }}</a>
                        </li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                </div> {% endcomment %}
<div class="recommended-search__collections">
  <div class="recommended-search__title">Recherches populaires</div>
  <ul class="predictive-search__list">
    {% for i in (1..6) %}
      {% assign text_key = 'recommended_text_' | append: i %}
      {% assign url_key = 'recommended_url_' | append: i %}
      
      {% assign collection_text = settings[text_key] %}
      {% assign collection_url = settings[url_key] %}
      
      {% if collection_text != blank and collection_url != blank %}
        <li>
          <a href="{{ collection_url }}">{{ collection_text }}</a>
        </li>
      {% endif %}
    {% endfor %}
  </ul>
</div>


                <!-- Produits populaires -->
                <div class="recommended-search__products">
                  <div class="recommended-search__title">Produits populaires</div>
                  <ul class="recommended-search__product-list">
                    {% for i in (1..6) %}
                      {% assign product_key = 'recommended_product_' | append: i %}
                      {% assign product_item = settings[product_key] %}
                      {% if product_item != blank %}
                        <li class="recommended-search__product-item">
                          <a href="{{ product_item.url }}" class="recommended-search__product-link">
                            <div class="recommended-search__product-image">
                              <img 
                                src="{{ product_item.featured_image | image_url: width: 150, height: 150 }}" 
                                alt="{{ product_item.title }}" 
                                width="150" 
                                height="150"
                                style="object-fit: cover;">
                            </div>
                            <div class="recommended-search__product-info">
                              <span class="recommended-search__product-title">{{ product_item.title }}</span>
                              <span class="recommended-search__product-price">
                                {{ product_item.price | money }}
                              </span>
                            </div>
                          </a>
                        </li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                </div>

              </div>
            </div>

            <span class="predictive-search-status visually-hidden" role="status" aria-hidden="true"></span>

          {%- endif -%}
        </form>

        {%- if settings.predictive_search_enabled -%}
          </predictive-search>
        {%- else -%}
          </search-form>
        {%- endif -%}

        <button type="button"
          class="search-modal__close-button modal__close-button link link--text focus-inset"
          aria-label="{{ 'accessibility.close' | t }}">
          <span class="svg-wrapper">
            {{- 'icon-close.svg' | inline_asset_content -}}
          </span>
        </button>
      </div>
    </div>
  </details>
</details-modal>
